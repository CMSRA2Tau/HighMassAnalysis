// Authors: Alfredo Gurrola

// system include files
#include <memory>

// user include files
#include "FWCore/Framework/interface/Frameworkfwd.h"
#include "FWCore/Framework/interface/EDAnalyzer.h"
#include "FWCore/Framework/interface/Event.h"
#include "FWCore/Framework/interface/MakerMacros.h"
#include "FWCore/ParameterSet/interface/ParameterSet.h"
#include "DataFormats/PatCandidates/interface/Tau.h"
#include "DataFormats/PatCandidates/interface/Muon.h"
#include "DataFormats/PatCandidates/interface/Electron.h"
#include "DataFormats/PatCandidates/interface/Jet.h"
#include "DataFormats/PatCandidates/interface/MET.h"
#include "DataFormats/PatCandidates/interface/CompositeCandidate.h"
#include "DataFormats/Math/interface/LorentzVector.h"
#include "DataFormats/Math/interface/LorentzVectorFwd.h"
#include "DataFormats/JetReco/interface/GenJetCollection.h"
#include "DataFormats/JetReco/interface/GenJet.h"
#include "DataFormats/PatCandidates/interface/Isolation.h"
#include "DataFormats/Math/interface/deltaR.h"
#include "DataFormats/Math/interface/normalizedPhi.h"
#include "DataFormats/TauReco/interface/PFTau.h"
#include "DataFormats/MuonReco/interface/MuonSelectors.h"
#include "DataFormats/Common/interface/RefVector.h"
#include "DataFormats/HepMCCandidate/interface/GenParticle.h"
#include "DataFormats/Candidate/interface/Candidate.h"
#include "DataFormats/Common/interface/Ref.h"
#include "DataFormats/Common/interface/ValueMap.h"
#include "DataFormats/VertexReco/interface/Vertex.h"
#include "DataFormats/VertexReco/interface/VertexFwd.h"
#include "FWCore/Common/interface/TriggerNames.h"
#include "DataFormats/Common/interface/TriggerResults.h"
#include "CLHEP/Random/RandGauss.h"
#include "CommonTools/CandUtils/interface/Booster.h"
#include "DataFormats/METReco/interface/GenMET.h"
#include "DataFormats/METReco/interface/GenMETCollection.h"
#include <Math/VectorUtil.h>
#include "DataFormats/HLTReco/interface/TriggerObject.h"
#include "DataFormats/HLTReco/interface/TriggerEvent.h"
#include "DataFormats/Common/interface/Handle.h"
#include "TrackingTools/TransientTrack/interface/TrackTransientTrack.h"
#include "TrackingTools/TransientTrack/interface/TransientTrackBuilder.h"
#include "TrackingTools/Records/interface/TransientTrackRecord.h"
#include "CLHEP/Units/GlobalPhysicalConstants.h"
#include "CommonTools/Statistics/interface/ChiSquaredProbability.h"
#include "CondFormats/JetMETObjects/interface/FactorizedJetCorrector.h"
#include "CondFormats/JetMETObjects/interface/JetCorrectionUncertainty.h"
#include "JetMETCorrections/Objects/interface/JetCorrectionsRecord.h"
#include "CondFormats/JetMETObjects/interface/JetCorrectorParameters.h"
#include "FWCore/Utilities/interface/Exception.h"
#include "FWCore/Framework/interface/ESHandle.h"
#include "boost/regex.hpp"

#include <TH1.h>
#include <TH2.h>
#include <TFile.h>
#include <TTree.h>
#include <string>
#include <vector>
#include <map>
#include <sstream>
#include <stdio.h>
#include <stdlib.h>
#include <TRandom3.h>

using namespace std;
using namespace edm;

typedef reco::Candidate::LorentzVector LorentzVector;
typedef std::vector< reco::Candidate::LorentzVector > LVCollection;

class HiMassTauAnalysis : public EDAnalyzer {
public:
  explicit HiMassTauAnalysis(const ParameterSet&);
  ~HiMassTauAnalysis();

      typedef std::vector<std::string>::const_iterator
      comments_const_iterator;

private:
  virtual void beginJob() ;
  virtual void analyze(const Event&, const EventSetup&);
  virtual void endJob() ;

  void getCollections(const Event&, const EventSetup&);
  void fillHistograms();
  void fillNtuple();
  void getEventFlags(const Event&);
  bool passEventSelectionSequence();
  bool passRecoTriggerCuts(const Event&);
  bool passRecoVertexCuts(const reco::Vertex&);
  bool passRecoTau1Cuts(const pat::Tau&,int);
  bool passRecoTau2Cuts(const pat::Tau&,int);
  bool passRecoMuon1Cuts(const pat::Muon&,int);
  bool passRecoMuon2Cuts(const pat::Muon&,int);
  bool passRecoElectron1Cuts(const pat::Electron&,int);
  bool passRecoElectron2Cuts(const pat::Electron&,int);
  bool passRecoJetCuts(const pat::Jet&,int);
  bool passRecoBJetCuts(const pat::Jet&,int);
  bool passRecoFirstLeadingJetCuts(const pat::Jet&,int);
  bool passRecoSecondLeadingJetCuts(const pat::Jet&,int);
  bool passMuon1Tau1TopologyCuts(const pat::Tau&, int, const pat::Muon&, int);
  bool passMuon1Tau2TopologyCuts(const pat::Tau&, int, const pat::Muon&, int);
  bool passMuon2Tau1TopologyCuts(const pat::Tau&, int, const pat::Muon&, int);
  bool passMuon2Tau2TopologyCuts(const pat::Tau&, int, const pat::Muon&, int);
  bool passElectron1Tau1TopologyCuts(const pat::Tau&, int, const pat::Electron&, int);
  bool passElectron1Tau2TopologyCuts(const pat::Tau&, int, const pat::Electron&, int);
  bool passElectron2Tau1TopologyCuts(const pat::Tau&, int, const pat::Electron&, int);
  bool passElectron2Tau2TopologyCuts(const pat::Tau&, int, const pat::Electron&, int);
  bool passElectron1Muon1TopologyCuts(const pat::Electron&, int,const pat::Muon&, int);
  bool passElectron1Muon2TopologyCuts(const pat::Electron&, int,const pat::Muon&, int);
  bool passElectron2Muon1TopologyCuts(const pat::Electron&, int,const pat::Muon&, int);
  bool passElectron2Muon2TopologyCuts(const pat::Electron&, int,const pat::Muon&, int);
  bool passDiMuonTopologyCuts(const pat::Muon&, int,const pat::Muon&, int);
  bool passDiTauTopologyCuts(const pat::Tau&, int, const pat::Tau&, int);
  bool passDiElectronTopologyCuts(const pat::Electron&, int,const pat::Electron&, int);
  bool passSusyTopologyCuts(int, int);
  pair<bool, reco::Candidate::LorentzVector> matchToGen(const pat::Electron&);
  pair<bool, reco::Candidate::LorentzVector> matchToGen(const pat::Muon&);
  pair<bool, reco::Candidate::LorentzVector> matchToGen(const pat::Tau&);
  double CalculatePZeta(const pat::Tau&, int, const pat::Muon&, int);
  double CalculatePZeta(const pat::Tau&, int, const pat::Electron&, int);
  double CalculatePZeta(const pat::Electron&, int,const pat::Muon&, int);
  double CalculatePZeta(const pat::Tau&, int, const pat::Tau&, int);
  double CalculatePZeta(const pat::Muon&, int,const pat::Muon&, int);
  double CalculatePZeta(const pat::Electron&, int,const pat::Electron&, int);
  double CalculatePZetaVis(const pat::Tau&, int, const pat::Muon&, int);
  double CalculatePZetaVis(const pat::Tau&, int, const pat::Electron&, int);
  double CalculatePZetaVis(const pat::Electron&, int, const pat::Muon&, int);
  double CalculatePZetaVis(const pat::Tau&, int, const pat::Tau&, int);
  double CalculatePZetaVis(const pat::Muon&, int,const pat::Muon&, int);
  double CalculatePZetaVis(const pat::Electron&, int, const pat::Electron&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Tau&, int, const pat::Electron&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Tau&, int, const pat::Muon&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Electron&, int,const pat::Muon&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Tau&, int, const pat::Tau&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Muon&, int, const pat::Muon&, int);
  std::pair<bool, reco::Candidate::LorentzVector> CalculateThe4Momentum(const pat::Electron&, int, const pat::Electron&, int);
  double CalculateLeptonMetMt(const pat::Muon&, int);
  double CalculateLeptonMetMt(const pat::Electron&, int);
  double CalculateLeptonMetMt(const pat::Tau&, int);
  double alphaRatio(double);
  std::pair<int, double> CalculateTauTrackIsolation(const pat::Tau&);
  std::pair<int, double> CalculateTauTrackIsolation(const pat::Tau&, float, float);
  std::pair<int, double> CalculateTauEcalIsolation(const pat::Tau&);
  std::pair<int, double> CalculateTauEcalIsolation(const pat::Tau&, float, float);
  int CalculateNumberSignalTauGammas(const pat::Tau&);
  reco::Candidate::LorentzVector CalculateTauSignalTracksMass(const pat::Tau&);
  reco::Candidate::LorentzVector CalculateTauSignalTracksAndGammasMass(const pat::Tau&);
  std::pair<reco::Candidate::LorentzVector,int> CalculateTauSignalTracksAndPiZerosMass(const pat::Tau&);
  std::pair<reco::Candidate::LorentzVector,math::PtEtaPhiMLorentzVector> SmearLightLepton(const pat::Muon&);
  std::pair<reco::Candidate::LorentzVector,math::PtEtaPhiMLorentzVector> SmearLightLepton(const pat::Electron&);
  std::pair<reco::Candidate::LorentzVector,math::PtEtaPhiMLorentzVector> SmearTau(const pat::Tau&);
  std::pair<reco::Candidate::LorentzVector,math::PtEtaPhiMLorentzVector> SmearJet(const pat::Jet&,JetCorrectionUncertainty *);
  std::pair<bool, std::pair<float, float> > isZee(reco::Candidate::LorentzVector);
  std::pair<bool, std::pair<float, float> > isZmm(reco::Candidate::LorentzVector);
  void InitializeInfoForPDFSystematicUncertaintites();
  void bookHistograms();
  void setMapSelectionAlgoIDs();
  void initMapSelectionCounters();
  void printEfficiency();
  void setupBranches();
  bool isInTheCracks(float);
  std::pair<unsigned int, unsigned int> getMatchedPdgId(float, float, float, int);
  void clearVectors();
  void initializeVectors();
  int getBin(char * cstr, int nVertices);
  double getvalue(char * cstr, int bin);
  double getintegral(char * cstr, int bin);

  // ----------member data ---------------------------

  //-----Generator level Inputs 
  bool _DoMSUGRApoint;
  InputTag _GenParticleSource;
  bool _SelectSusyScanPoint;
  double _M0;
  double _M12;

  bool _DoSMpoint;
  double _mLSP;
  double _mGL;

  //-----Reco Tau Inputs 
  InputTag _RecoTauSource;
  double _RecoTau1PtMinCut;
  double _RecoTau1PtMaxCut;
  double _RecoTau1EtaCut;
  double _RecoTau1LeadTrackThreshold;
  double _RecoTau1SigGamThreshold;
  double _RecoTau1IsoDeltaRCone;
  double _RecoTau1TrackIsoTrkThreshold;
  double _RecoTau1GammaIsoGamThreshold;
  double _RecoTauSigGamThreshold;
  double _RecoTauIsoDeltaRCone;
  double _RecoTauTrackIsoTrkThreshold;
  double _RecoTauGammaIsoGamThreshold;
  double _RecoTau1TrackIsoSumPtMinCutValue;
  double _RecoTau1TrackIsoSumPtMaxCutValue;
  double _RecoTau1EcalIsoSumPtMinCutValue;
  double _RecoTau1EcalIsoSumPtMaxCutValue;
  double _RecoTau1EcalIsoRphiForEllipse;
  double _RecoTau1EcalIsoRetaForEllipse;
  double _RecoTauEcalIsoRphiForEllipse;
  double _RecoTauEcalIsoRetaForEllipse;
  double _RecoTau1Signal3ProngAndGammasMassMinCutValue;
  double _RecoTau1Signal3ProngAndGammasMassMaxCutValue;
  double _RecoTau1Signal1ProngAndGammasMassForPionMinCutValue;
  double _RecoTau1Signal1ProngAndGammasMassForPionMaxCutValue;
  double _RecoTau1Signal1ProngAndGammasMassForKaonVetoMinCutValue;
  double _RecoTau1Signal1ProngAndGammasMassForKaonVetoMaxCutValue;
  int _RecoTau1TrackNisoMax;
  int _RecoTau1EcalNisoMax;
  int _RecoTau1LeadTrackMinHits;
  bool _DoRecoTau1DiscrByIsolation;
  bool _UseRecoTau1DiscrByIsolationFlag;
  bool _UseRecoTau1IsoSumPtInsteadOfNiso;
  bool _UseRecoTau1EllipseForEcalIso;
  bool _UseRecoTauEllipseForEcalIso;
  bool _DoRecoTau1DiscrByLeadTrack;
  bool _DoRecoTau1DiscrByLeadTrackNhits;
  bool _UseRecoTau1DiscrByLeadTrackFlag;
  bool _DoRecoTau1DiscrAgainstElectron;
  bool _DoRecoTau1DiscrAgainstMuon;
  bool _DoRecoTau1DiscrByCrackCut;
  bool _DoRecoTau1DiscrBySignalTracksAndGammasMass;
  bool _SelectTau1sThatAreMuons;
  bool _SelectTau1sThatAreElectrons;
  string _RecoTau1DiscrByIsolation;
  string _RecoTau1DiscrByLeadTrack;
  string _RecoTau1DiscrAgainstElectron;
  string _RecoTau1DiscrAgainstMuon;
  string _RecoTau1DiscrByProngType;
  bool _DoRecoTau1DiscrByH3x3OverP;
  double _RecoTau1H3x3OverP;
  double _RecoTau2PtMinCut;
  double _RecoTau2PtMaxCut;
  double _RecoTau2EtaCut;
  double _RecoTau2LeadTrackThreshold;
  double _RecoTau2SigGamThreshold;
  double _RecoTau2IsoDeltaRCone;
  double _RecoTau2TrackIsoTrkThreshold;
  double _RecoTau2GammaIsoGamThreshold;
  double _RecoTau2TrackIsoSumPtMinCutValue;
  double _RecoTau2TrackIsoSumPtMaxCutValue;
  double _RecoTau2EcalIsoSumPtMinCutValue;
  double _RecoTau2EcalIsoSumPtMaxCutValue;
  double _RecoTau2EcalIsoRphiForEllipse;
  double _RecoTau2EcalIsoRetaForEllipse;
  double _RecoTau2Signal3ProngAndGammasMassMinCutValue;
  double _RecoTau2Signal3ProngAndGammasMassMaxCutValue;
  double _RecoTau2Signal1ProngAndGammasMassForPionMinCutValue;
  double _RecoTau2Signal1ProngAndGammasMassForPionMaxCutValue;
  double _RecoTau2Signal1ProngAndGammasMassForKaonVetoMinCutValue;
  double _RecoTau2Signal1ProngAndGammasMassForKaonVetoMaxCutValue;
  int _RecoTau2TrackNisoMax;
  int _RecoTau2EcalNisoMax;
  int _RecoTau2LeadTrackMinHits;
  bool _DoRecoTau2DiscrByIsolation;
  bool _UseRecoTau2DiscrByIsolationFlag;
  bool _UseRecoTau2IsoSumPtInsteadOfNiso;
  bool _UseRecoTau2EllipseForEcalIso;
  bool _DoRecoTau2DiscrByLeadTrack;
  bool _DoRecoTau2DiscrByLeadTrackNhits;
  bool _UseRecoTau2DiscrByLeadTrackFlag;
  bool _DoRecoTau2DiscrAgainstElectron;
  bool _DoRecoTau2DiscrAgainstMuon;
  bool _DoRecoTau2DiscrByCrackCut;
  bool _DoRecoTau2DiscrBySignalTracksAndGammasMass;
  bool _SelectTau2sThatAreMuons;
  bool _SelectTau2sThatAreElectrons;
  string _RecoTau2DiscrByIsolation;
  string _RecoTau2DiscrByLeadTrack;
  string _RecoTau2DiscrAgainstElectron;
  string _RecoTau2DiscrAgainstMuon;
  string _RecoTau2DiscrByProngType;
  bool _DoRecoTau2DiscrByH3x3OverP;
  double _RecoTau2H3x3OverP;

  //-----Reco Muon Inputs
  InputTag _RecoMuonSource;
  double _RecoMuon1PtMinCut;
  double _RecoMuon1PtMaxCut;
  double _RecoMuon1EtaCut;
  double _RecoMuon1TrackIsoSumPtMinCutValue;
  double _RecoMuon1TrackIsoSumPtMaxCutValue;
  double _RecoMuon1EcalIsoSumPtMinCutValue;
  double _RecoMuon1EcalIsoSumPtMaxCutValue;
  double _RecoMuon1IsoDeltaRCone;
  double _RecoMuon1TrackIsoTrkThreshold;
  double _RecoMuon1EcalIsoRecHitThreshold;
  double _RecoMuon1IpCut;
  double _RecoMuon1CaloCompCoefficient;
  double _RecoMuon1SegmCompCoefficient;
  double _RecoMuon1AntiPionCut;
  bool _DoRecoMuon1DiscrByGlobal;
  bool _DoRecoMuon1DiscrByIsolation;
  bool _DoRecoMuon1DiscrByIp;
  bool _DoRecoMuon1DiscrByPionVeto;
  double _RecoMuon2PtMinCut;
  double _RecoMuon2PtMaxCut;
  double _RecoMuon2EtaCut;
  double _RecoMuon2TrackIsoSumPtMinCutValue;
  double _RecoMuon2TrackIsoSumPtMaxCutValue;
  double _RecoMuon2EcalIsoSumPtMinCutValue;
  double _RecoMuon2EcalIsoSumPtMaxCutValue;
  double _RecoMuon2IsoDeltaRCone;
  double _RecoMuon2TrackIsoTrkThreshold;
  double _RecoMuon2EcalIsoRecHitThreshold;
  double _RecoMuon2IpCut;
  double _RecoMuon2CaloCompCoefficient;
  double _RecoMuon2SegmCompCoefficient;
  double _RecoMuon2AntiPionCut;
  bool _DoRecoMuon2DiscrByGlobal;
  bool _DoRecoMuon2DiscrByIsolation;
  bool _DoRecoMuon2DiscrByIp;
  bool _DoRecoMuon2DiscrByPionVeto;

  //-----Reco Electron Inputs
  InputTag _RecoElectronSource;
  double _RecoElectron1PtMinCut;
  double _RecoElectron1PtMaxCut;
  double _RecoElectron1EtaCut;
  double _RecoElectron1TrackIsoSumPtMaxCutValue;
  double _RecoElectron1TrackIsoSumPtMinCutValue;
  double _RecoElectron1TrackIsoDeltaRCone;
  double _RecoElectron1TrackIsoTrkThreshold;
  double _RecoElectron1EcalIsoSumPtMaxCutValue;
  double _RecoElectron1EcalIsoSumPtMinCutValue;
  double _RecoElectron1EcalIsoDeltaRCone;
  double _RecoElectron1EcalIsoRecHitThreshold;
  double _RecoElectron1IpCut;  
  double _RecoElectron1EoverPMax;
  double _RecoElectron1EoverPMin;
  double _RecoElectron1HoverEmCut;
  bool _UseHeepInfo;
  bool _DoRecoElectron1DiscrByTrackIsolation;
  bool _DoRecoElectron1DiscrByEcalIsolation;
  bool _DoRecoElectron1DiscrByIp;
  bool _DoRecoElectron1DiscrByEoverP;
  bool _DoRecoElectron1DiscrByHoverEm;
  bool _DoRecoElectron1DiscrByEcalDrivenSeed;
  bool _DoRecoElectron1DiscrByTrackerDrivenSeed;
  bool _DoRecoElectron1DiscrBySigmaIEtaIEta;
  double _RecoElectron1SigmaIEtaIEta;
  bool _DoRecoElectron1DiscrByDEtaIn;
  double _RecoElectron1EEDEtaIn;
  double _RecoElectron1EBDEtaIn;
  bool _DoRecoElectron1DiscrByDPhiIn;
  double _RecoElectron1EEDPhiIn;
  double _RecoElectron1EBDPhiIn;
  bool _DoRecoElectron1DiscrBySCE2by5Over5by5;
  double _RecoElectron1EBscE1by5Over5by5;
  double _RecoElectron1EBscE2by5Over5by5;
  bool _DoRecoElectron1DiscrByMissingHits;
  int _RecoElectron1MissingHits;
  double _RecoElectron2PtMinCut;
  double _RecoElectron2PtMaxCut;
  double _RecoElectron2EtaCut;
  double _RecoElectron2TrackIsoSumPtMaxCutValue;
  double _RecoElectron2TrackIsoSumPtMinCutValue;
  double _RecoElectron2TrackIsoDeltaRCone;
  double _RecoElectron2TrackIsoTrkThreshold;
  double _RecoElectron2EcalIsoSumPtMaxCutValue;
  double _RecoElectron2EcalIsoSumPtMinCutValue;
  double _RecoElectron2EcalIsoDeltaRCone;
  double _RecoElectron2EcalIsoRecHitThreshold;
  double _RecoElectron2IpCut;  
  double _RecoElectron2EoverPMax;
  double _RecoElectron2EoverPMin;
  double _RecoElectron2HoverEmCut;
  bool _DoRecoElectron2DiscrByTrackIsolation;
  bool _DoRecoElectron2DiscrByEcalIsolation;
  bool _DoRecoElectron2DiscrByIp;
  bool _DoRecoElectron2DiscrByEoverP;
  bool _DoRecoElectron2DiscrByHoverEm;
  bool _DoRecoElectron2DiscrByEcalDrivenSeed;
  bool _DoRecoElectron2DiscrByTrackerDrivenSeed;
  bool _DoRecoElectron2DiscrBySigmaIEtaIEta;
  double _RecoElectron2SigmaIEtaIEta;
  bool _DoRecoElectron2DiscrByDEtaIn;
  double _RecoElectron2EEDEtaIn;
  double _RecoElectron2EBDEtaIn;
  bool _DoRecoElectron2DiscrByDPhiIn;
  double _RecoElectron2EEDPhiIn;
  double _RecoElectron2EBDPhiIn;
  bool _DoRecoElectron2DiscrBySCE2by5Over5by5;
  double _RecoElectron2EBscE1by5Over5by5;
  double _RecoElectron2EBscE2by5Over5by5;
  bool _DoRecoElectron2DiscrByMissingHits;
  int _RecoElectron2MissingHits;

  //-----Reco Jet Inputs
  InputTag _RecoJetSource;
  double _RecoJetPtCut;
  double _RecoJetEtaMinCut;
  double _RecoJetEtaMaxCut;
  double _JetMuon1MatchingDeltaR;
  double _JetElectron1MatchingDeltaR;
  double _JetTau1MatchingDeltaR;
  double _SecondLeadingJetMuon1MatchingDeltaR;
  double _SecondLeadingJetElectron1MatchingDeltaR;
  double _SecondLeadingJetTau1MatchingDeltaR;
  double _FirstLeadingJetMuon1MatchingDeltaR;
  double _FirstLeadingJetElectron1MatchingDeltaR;
  double _FirstLeadingJetTau1MatchingDeltaR;
  double _JetMuon2MatchingDeltaR;
  double _JetElectron2MatchingDeltaR;
  double _JetTau2MatchingDeltaR;
  double _SecondLeadingJetMuon2MatchingDeltaR;
  double _SecondLeadingJetElectron2MatchingDeltaR;
  double _SecondLeadingJetTau2MatchingDeltaR;
  double _FirstLeadingJetMuon2MatchingDeltaR;
  double _FirstLeadingJetElectron2MatchingDeltaR;
  double _FirstLeadingJetTau2MatchingDeltaR;
//  double _JetBTaggingTCHEcut;
  double _RecoFirstLeadingJetPt;
  double _RecoFirstLeadingJetEtaMinCut;
  double _RecoFirstLeadingJetEtaMaxCut;
  double _RecoSecondLeadingJetPt;
  double _RecoSecondLeadingJetEtaMinCut;
  double _RecoSecondLeadingJetEtaMaxCut;
  bool _UseCorrectedJet;
  bool _RemoveJetOverlapWithMuon1s;
  bool _RemoveJetOverlapWithElectron1s;
  bool _RemoveJetOverlapWithTau1s;
  bool _RemoveSecondLeadingJetOverlapWithMuon1s;
  bool _RemoveSecondLeadingJetOverlapWithElectron1s;
  bool _RemoveSecondLeadingJetOverlapWithTau1s;
  bool _RemoveFirstLeadingJetOverlapWithMuon1s;
  bool _RemoveFirstLeadingJetOverlapWithElectron1s;
  bool _RemoveFirstLeadingJetOverlapWithTau1s;
  bool _RemoveJetOverlapWithMuon2s;
  bool _RemoveJetOverlapWithElectron2s;
  bool _RemoveJetOverlapWithTau2s;
  bool _RemoveSecondLeadingJetOverlapWithMuon2s;
  bool _RemoveSecondLeadingJetOverlapWithElectron2s;
  bool _RemoveSecondLeadingJetOverlapWithTau2s;
  bool _RemoveFirstLeadingJetOverlapWithMuon2s;
  bool _RemoveFirstLeadingJetOverlapWithElectron2s;
  bool _RemoveFirstLeadingJetOverlapWithTau2s;
//  bool _ApplyJetBTagging;
  bool _DoDiscrByFirstLeadingJet;
  bool _DoDiscrBySecondLeadingJet;

  //-----Reco b-Jet Inputs
  double _RecoBJetPtCut;
  double _RecoBJetEtaMinCut;
  double _RecoBJetEtaMaxCut;
  double _BJetMuon1MatchingDeltaR;
  double _BJetElectron1MatchingDeltaR;
  double _BJetTau1MatchingDeltaR;
  double _BJetMuon2MatchingDeltaR;
  double _BJetElectron2MatchingDeltaR;
  double _BJetTau2MatchingDeltaR;
  double _JetBTaggingCut;
  bool _RemoveBJetOverlapWithMuon1s;
  bool _RemoveBJetOverlapWithElectron1s;
  bool _RemoveBJetOverlapWithTau1s;
  bool _RemoveBJetOverlapWithMuon2s;
  bool _RemoveBJetOverlapWithElectron2s;
  bool _RemoveBJetOverlapWithTau2s;
  bool _ApplyJetBTagging;
  string _bTagger;

  double sumpxForMht;
  double sumpyForMht;
  double sumptForHt;
  double leadingjetpt;
  double secondleadingjetpt;
  int theLeadingJetIndex;
  int theSecondLeadingJetIndex;

  //-----Vertex Inputs
  InputTag _RecoVertexSource;
  double _RecoVertexMaxZposition;
  double _RecoVertexTrackWeight;
  int _RecoVertexMinTracks;

  string _DataHistos;
  string  _MCHistos;

  //-----Trigger Inputs
  InputTag _RecoTriggerSource;
  std::vector<std::string> _TriggerRequirements;

  //-----Topology Inputs
  InputTag _RecoMetSource;
  double _RecoMetCut;
  double _DiTauDeltaRCut;
  double _DiTauCosDphiMinCut;
  double _DiTauCosDphiMaxCut;
  double _DiTauMassMinCut;
  double _DiTauMassMaxCut;
  double _DiTauPZetaCutCoefficient;
  double _DiTauPZetaVisCutCoefficient;
  double _DiTauCDFzeta2DCutValue;
  double _DiTauDeltaPtDivSumPtMinCutValue;
  double _DiTauDeltaPtDivSumPtMaxCutValue;
  double _DiTauDeltaPtMinCutValue;
  double _DiTauDeltaPtMaxCutValue;
  double _DiMuonDeltaRCut;
  double _DiMuonCosDphiMinCut;
  double _DiMuonCosDphiMaxCut;
  double _DiMuonMassMinCut;
  double _DiMuonMassMaxCut;
  double _DiMuonPZetaCutCoefficient;
  double _DiMuonPZetaVisCutCoefficient;
  double _DiMuonCDFzeta2DCutValue;
  double _DiMuonDeltaPtDivSumPtMinCutValue;
  double _DiMuonDeltaPtDivSumPtMaxCutValue;
  double _DiMuonDeltaPtMinCutValue;
  double _DiMuonDeltaPtMaxCutValue;
  double _DiElectronDeltaRCut;
  double _DiElectronCosDphiMinCut;
  double _DiElectronCosDphiMaxCut;
  double _DiElectronMassMinCut;
  double _DiElectronMassMaxCut;
  double _DiElectronPZetaCutCoefficient;
  double _DiElectronPZetaVisCutCoefficient;
  double _DiElectronCDFzeta2DCutValue;
  double _DiElectronDeltaPtDivSumPtMinCutValue;
  double _DiElectronDeltaPtDivSumPtMaxCutValue;
  double _DiElectronDeltaPtMinCutValue;
  double _DiElectronDeltaPtMaxCutValue;
  double _Muon1Tau1DeltaRCut;
  double _Muon1Tau1CosDphiMinCut;
  double _Muon1Tau1CosDphiMaxCut;
  double _Muon1Tau1MassMinCut;
  double _Muon1Tau1MassMaxCut;
  double _Muon1Tau1PZetaCutCoefficient;
  double _Muon1Tau1PZetaVisCutCoefficient;
  double _Muon1Tau1CDFzeta2DCutValue;
  double _Muon1Tau1DeltaPtDivSumPtMinCutValue;
  double _Muon1Tau1DeltaPtDivSumPtMaxCutValue;
  double _Muon1Tau1DeltaPtMinCutValue;
  double _Muon1Tau1DeltaPtMaxCutValue;
  double _Muon1Tau2DeltaRCut;
  double _Muon1Tau2CosDphiMinCut;
  double _Muon1Tau2CosDphiMaxCut;
  double _Muon1Tau2MassMinCut;
  double _Muon1Tau2MassMaxCut;
  double _Muon1Tau2PZetaCutCoefficient;
  double _Muon1Tau2PZetaVisCutCoefficient;
  double _Muon1Tau2CDFzeta2DCutValue;
  double _Muon1Tau2DeltaPtDivSumPtMinCutValue;
  double _Muon1Tau2DeltaPtDivSumPtMaxCutValue;
  double _Muon1Tau2DeltaPtMinCutValue;
  double _Muon1Tau2DeltaPtMaxCutValue;
  double _Muon2Tau1DeltaRCut;
  double _Muon2Tau1CosDphiMinCut;
  double _Muon2Tau1CosDphiMaxCut;
  double _Muon2Tau1MassMinCut;
  double _Muon2Tau1MassMaxCut;
  double _Muon2Tau1PZetaCutCoefficient;
  double _Muon2Tau1PZetaVisCutCoefficient;
  double _Muon2Tau1CDFzeta2DCutValue;
  double _Muon2Tau1DeltaPtDivSumPtMinCutValue;
  double _Muon2Tau1DeltaPtDivSumPtMaxCutValue;
  double _Muon2Tau1DeltaPtMinCutValue;
  double _Muon2Tau1DeltaPtMaxCutValue;
  double _Muon2Tau2DeltaRCut;
  double _Muon2Tau2CosDphiMinCut;
  double _Muon2Tau2CosDphiMaxCut;
  double _Muon2Tau2MassMinCut;
  double _Muon2Tau2MassMaxCut;
  double _Muon2Tau2PZetaCutCoefficient;
  double _Muon2Tau2PZetaVisCutCoefficient;
  double _Muon2Tau2CDFzeta2DCutValue;
  double _Muon2Tau2DeltaPtDivSumPtMinCutValue;
  double _Muon2Tau2DeltaPtDivSumPtMaxCutValue;
  double _Muon2Tau2DeltaPtMinCutValue;
  double _Muon2Tau2DeltaPtMaxCutValue;
  double _Electron1Tau1DeltaRCut;
  double _Electron1Tau1CosDphiMinCut;
  double _Electron1Tau1CosDphiMaxCut;
  double _Electron1Tau1MassMinCut;
  double _Electron1Tau1MassMaxCut;
  double _Electron1Tau1PZetaCutCoefficient;
  double _Electron1Tau1PZetaVisCutCoefficient;
  double _Electron1Tau1CDFzeta2DCutValue;
  double _Electron1Tau1DeltaPtDivSumPtMinCutValue;
  double _Electron1Tau1DeltaPtDivSumPtMaxCutValue;
  double _Electron1Tau1DeltaPtMinCutValue;
  double _Electron1Tau1DeltaPtMaxCutValue;
  double _Electron1Tau2DeltaRCut;
  double _Electron1Tau2CosDphiMinCut;
  double _Electron1Tau2CosDphiMaxCut;
  double _Electron1Tau2MassMinCut;
  double _Electron1Tau2MassMaxCut;
  double _Electron1Tau2PZetaCutCoefficient;
  double _Electron1Tau2PZetaVisCutCoefficient;
  double _Electron1Tau2CDFzeta2DCutValue;
  double _Electron1Tau2DeltaPtDivSumPtMinCutValue;
  double _Electron1Tau2DeltaPtDivSumPtMaxCutValue;
  double _Electron1Tau2DeltaPtMinCutValue;
  double _Electron1Tau2DeltaPtMaxCutValue;
  double _Electron2Tau1DeltaRCut;
  double _Electron2Tau1CosDphiMinCut;
  double _Electron2Tau1CosDphiMaxCut;
  double _Electron2Tau1MassMinCut;
  double _Electron2Tau1MassMaxCut;
  double _Electron2Tau1PZetaCutCoefficient;
  double _Electron2Tau1PZetaVisCutCoefficient;
  double _Electron2Tau1CDFzeta2DCutValue;
  double _Electron2Tau1DeltaPtDivSumPtMinCutValue;
  double _Electron2Tau1DeltaPtDivSumPtMaxCutValue;
  double _Electron2Tau1DeltaPtMinCutValue;
  double _Electron2Tau1DeltaPtMaxCutValue;
  double _Electron2Tau2DeltaRCut;
  double _Electron2Tau2CosDphiMinCut;
  double _Electron2Tau2CosDphiMaxCut;
  double _Electron2Tau2MassMinCut;
  double _Electron2Tau2MassMaxCut;
  double _Electron2Tau2PZetaCutCoefficient;
  double _Electron2Tau2PZetaVisCutCoefficient;
  double _Electron2Tau2CDFzeta2DCutValue;
  double _Electron2Tau2DeltaPtDivSumPtMinCutValue;
  double _Electron2Tau2DeltaPtDivSumPtMaxCutValue;
  double _Electron2Tau2DeltaPtMinCutValue;
  double _Electron2Tau2DeltaPtMaxCutValue;
  double _Electron1Muon1DeltaRCut;
  double _Electron1Muon1CosDphiMinCut;
  double _Electron1Muon1CosDphiMaxCut;
  double _Electron1Muon1MassMinCut;
  double _Electron1Muon1MassMaxCut;
  double _Electron1Muon1PZetaCutCoefficient;
  double _Electron1Muon1PZetaVisCutCoefficient;
  double _Electron1Muon1CDFzeta2DCutValue;
  double _Electron1Muon1DeltaPtDivSumPtMinCutValue;
  double _Electron1Muon1DeltaPtDivSumPtMaxCutValue;
  double _Electron1Muon1DeltaPtMinCutValue;
  double _Electron1Muon1DeltaPtMaxCutValue;
  double _Electron1Muon2DeltaRCut;
  double _Electron1Muon2CosDphiMinCut;
  double _Electron1Muon2CosDphiMaxCut;
  double _Electron1Muon2MassMinCut;
  double _Electron1Muon2MassMaxCut;
  double _Electron1Muon2PZetaCutCoefficient;
  double _Electron1Muon2PZetaVisCutCoefficient;
  double _Electron1Muon2CDFzeta2DCutValue;
  double _Electron1Muon2DeltaPtDivSumPtMinCutValue;
  double _Electron1Muon2DeltaPtDivSumPtMaxCutValue;
  double _Electron1Muon2DeltaPtMinCutValue;
  double _Electron1Muon2DeltaPtMaxCutValue;
  double _Electron2Muon1DeltaRCut;
  double _Electron2Muon1CosDphiMinCut;
  double _Electron2Muon1CosDphiMaxCut;
  double _Electron2Muon1MassMinCut;
  double _Electron2Muon1MassMaxCut;
  double _Electron2Muon1PZetaCutCoefficient;
  double _Electron2Muon1PZetaVisCutCoefficient;
  double _Electron2Muon1CDFzeta2DCutValue;
  double _Electron2Muon1DeltaPtDivSumPtMinCutValue;
  double _Electron2Muon1DeltaPtDivSumPtMaxCutValue;
  double _Electron2Muon1DeltaPtMinCutValue;
  double _Electron2Muon1DeltaPtMaxCutValue;
  double _Electron2Muon2DeltaRCut;
  double _Electron2Muon2CosDphiMinCut;
  double _Electron2Muon2CosDphiMaxCut;
  double _Electron2Muon2MassMinCut;
  double _Electron2Muon2MassMaxCut;
  double _Electron2Muon2PZetaCutCoefficient;
  double _Electron2Muon2PZetaVisCutCoefficient;
  double _Electron2Muon2CDFzeta2DCutValue;
  double _Electron2Muon2DeltaPtDivSumPtMinCutValue;
  double _Electron2Muon2DeltaPtDivSumPtMaxCutValue;
  double _Electron2Muon2DeltaPtMinCutValue;
  double _Electron2Muon2DeltaPtMaxCutValue;
  double _Muon1MetDphiMinCut;
  double _Muon1MetDphiMaxCut;
  double _Muon2MetDphiMinCut;
  double _Muon2MetDphiMaxCut;
  double _Electron1MetDphiMinCut;
  double _Electron1MetDphiMaxCut;
  double _Electron2MetDphiMinCut;
  double _Electron2MetDphiMaxCut;
  double _Tau1MetDphiMinCut;
  double _Tau1MetDphiMaxCut;
  double _Tau2MetDphiMinCut;
  double _Tau2MetDphiMaxCut;
  bool _DoDiscrByMet;
  bool _DoDiTauDiscrByDeltaR;
  bool _UseTauSeedTrackForDiTauDiscrByOSLS;
  bool _DoDiTauDiscrByCosDphi;
  bool _DoDiscrByDiTauMassReco;
  bool _DoDiTauDiscrByCDFzeta2D;
  bool _DoDiTauDiscrByDeltaPtDivSumPt;
  bool _DoDiTauDiscrByDeltaPt;
  bool _DoDiMuonDiscrByDeltaR;
  bool _UseTauSeedTrackForDiMuonDiscrByOSLS;
  bool _DoDiMuonDiscrByCosDphi;
  bool _DoDiscrByDiMuonMassReco;
  bool _DoDiMuonDiscrByCDFzeta2D;
  bool _DoDiMuonDiscrByDeltaPtDivSumPt;
  bool _DoDiMuonDiscrByDeltaPt;
  bool _DoDiElectronDiscrByDeltaR;
  bool _UseTauSeedTrackForDiElectronDiscrByOSLS;
  bool _DoDiElectronDiscrByCosDphi;
  bool _DoDiscrByDiElectronMassReco;
  bool _DoDiElectronDiscrByCDFzeta2D;
  bool _DoDiElectronDiscrByDeltaPtDivSumPt;
  bool _DoDiElectronDiscrByDeltaPt;
  bool _DoMuon1Tau1DiscrByDeltaR;
  bool _UseTauSeedTrackForMuon1Tau1DiscrByOSLS;
  bool _DoMuon1Tau1DiscrByCosDphi;
  bool _DoDiscrByMuon1Tau1MassReco;
  bool _DoMuon1Tau1DiscrByCDFzeta2D;
  bool _DoMuon1Tau1DiscrByDeltaPtDivSumPt;
  bool _DoMuon1Tau1DiscrByDeltaPt;
  bool _DoMuon1Tau2DiscrByDeltaR;
  bool _UseTauSeedTrackForMuon1Tau2DiscrByOSLS;
  bool _DoMuon1Tau2DiscrByCosDphi;
  bool _DoDiscrByMuon1Tau2MassReco;
  bool _DoMuon1Tau2DiscrByCDFzeta2D;
  bool _DoMuon1Tau2DiscrByDeltaPtDivSumPt;
  bool _DoMuon1Tau2DiscrByDeltaPt;
  bool _DoMuon2Tau1DiscrByDeltaR;
  bool _UseTauSeedTrackForMuon2Tau1DiscrByOSLS;
  bool _DoMuon2Tau1DiscrByCosDphi;
  bool _DoDiscrByMuon2Tau1MassReco;
  bool _DoMuon2Tau1DiscrByCDFzeta2D;
  bool _DoMuon2Tau1DiscrByDeltaPtDivSumPt;
  bool _DoMuon2Tau1DiscrByDeltaPt;
  bool _DoMuon2Tau2DiscrByDeltaR;
  bool _UseTauSeedTrackForMuon2Tau2DiscrByOSLS;
  bool _DoMuon2Tau2DiscrByCosDphi;
  bool _DoDiscrByMuon2Tau2MassReco;
  bool _DoMuon2Tau2DiscrByCDFzeta2D;
  bool _DoMuon2Tau2DiscrByDeltaPtDivSumPt;
  bool _DoMuon2Tau2DiscrByDeltaPt;
  bool _DoElectron1Tau1DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron1Tau1DiscrByOSLS;
  bool _DoElectron1Tau1DiscrByCosDphi;
  bool _DoDiscrByElectron1Tau1MassReco;
  bool _DoElectron1Tau1DiscrByCDFzeta2D;
  bool _DoElectron1Tau1DiscrByDeltaPtDivSumPt;
  bool _DoElectron1Tau1DiscrByDeltaPt;
  bool _DoElectron1Tau2DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron1Tau2DiscrByOSLS;
  bool _DoElectron1Tau2DiscrByCosDphi;
  bool _DoDiscrByElectron1Tau2MassReco;
  bool _DoElectron1Tau2DiscrByCDFzeta2D;
  bool _DoElectron1Tau2DiscrByDeltaPtDivSumPt;
  bool _DoElectron1Tau2DiscrByDeltaPt;
  bool _DoElectron2Tau1DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron2Tau1DiscrByOSLS;
  bool _DoElectron2Tau1DiscrByCosDphi;
  bool _DoDiscrByElectron2Tau1MassReco;
  bool _DoElectron2Tau1DiscrByCDFzeta2D;
  bool _DoElectron2Tau1DiscrByDeltaPtDivSumPt;
  bool _DoElectron2Tau1DiscrByDeltaPt;
  bool _DoElectron2Tau2DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron2Tau2DiscrByOSLS;
  bool _DoElectron2Tau2DiscrByCosDphi;
  bool _DoDiscrByElectron2Tau2MassReco;
  bool _DoElectron2Tau2DiscrByCDFzeta2D;
  bool _DoElectron2Tau2DiscrByDeltaPtDivSumPt;
  bool _DoElectron2Tau2DiscrByDeltaPt;
  bool _DoElectron1Muon1DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron1Muon1DiscrByOSLS;
  bool _DoElectron1Muon1DiscrByCosDphi;
  bool _DoDiscrByElectron1Muon1MassReco;
  bool _DoElectron1Muon1DiscrByCDFzeta2D;
  bool _DoElectron1Muon1DiscrByDeltaPtDivSumPt;
  bool _DoElectron1Muon1DiscrByDeltaPt;
  bool _DoElectron1Muon2DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron1Muon2DiscrByOSLS;
  bool _DoElectron1Muon2DiscrByCosDphi;
  bool _DoDiscrByElectron1Muon2MassReco;
  bool _DoElectron1Muon2DiscrByCDFzeta2D;
  bool _DoElectron1Muon2DiscrByDeltaPtDivSumPt;
  bool _DoElectron1Muon2DiscrByDeltaPt;
  bool _DoElectron2Muon1DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron2Muon1DiscrByOSLS;
  bool _DoElectron2Muon1DiscrByCosDphi;
  bool _DoDiscrByElectron2Muon1MassReco;
  bool _DoElectron2Muon1DiscrByCDFzeta2D;
  bool _DoElectron2Muon1DiscrByDeltaPtDivSumPt;
  bool _DoElectron2Muon1DiscrByDeltaPt;
  bool _DoElectron2Muon2DiscrByDeltaR;
  bool _UseTauSeedTrackForElectron2Muon2DiscrByOSLS;
  bool _DoElectron2Muon2DiscrByCosDphi;
  bool _DoDiscrByElectron2Muon2MassReco;
  bool _DoElectron2Muon2DiscrByCDFzeta2D;
  bool _DoElectron2Muon2DiscrByDeltaPtDivSumPt;
  bool _DoElectron2Muon2DiscrByDeltaPt;
  bool _UseVectorSumOfDiTauProductsAndMetMassReco;
  bool _UseCollinerApproxDiTauMassReco;
  bool _UseVectorSumOfDiMuonProductsAndMetMassReco;
  bool _UseCollinerApproxDiMuonMassReco;
  bool _UseVectorSumOfDiElectronProductsAndMetMassReco;
  bool _UseCollinerApproxDiElectronMassReco;
  bool _UseVectorSumOfMuon1Tau1ProductsAndMetMassReco;
  bool _UseCollinerApproxMuon1Tau1MassReco;
  bool _UseVectorSumOfMuon1Tau2ProductsAndMetMassReco;
  bool _UseCollinerApproxMuon1Tau2MassReco;
  bool _UseVectorSumOfMuon2Tau1ProductsAndMetMassReco;
  bool _UseCollinerApproxMuon2Tau1MassReco;
  bool _UseVectorSumOfMuon2Tau2ProductsAndMetMassReco;
  bool _UseCollinerApproxMuon2Tau2MassReco;
  bool _UseVectorSumOfElectron1Tau1ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron1Tau1MassReco;
  bool _UseVectorSumOfElectron1Tau2ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron1Tau2MassReco;
  bool _UseVectorSumOfElectron2Tau1ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron2Tau1MassReco;
  bool _UseVectorSumOfElectron2Tau2ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron2Tau2MassReco;
  bool _UseVectorSumOfElectron1Muon1ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron1Muon1MassReco;
  bool _UseVectorSumOfElectron1Muon2ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron1Muon2MassReco;
  bool _UseVectorSumOfElectron2Muon1ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron2Muon1MassReco;
  bool _UseVectorSumOfElectron2Muon2ProductsAndMetMassReco;
  bool _UseCollinerApproxElectron2Muon2MassReco;
  bool _UseVectorSumOfVisProductsAndMetMassReco;
  bool _UseCollinerApproxMassReco;
  bool _DoDiscrByMuon1MetDphi;
  bool _DoDiscrByMuon2MetDphi;
  bool _DoDiscrByElectron1MetDphi;
  bool _DoDiscrByElectron2MetDphi;
  bool _DoDiscrByTau1MetDphi;
  bool _DoDiscrByTau2MetDphi;
  bool _DoMuon1DiscrByIsZllCut;
  bool _DoMuon2DiscrByIsZllCut;
  bool _DoElectron1DiscrByIsZllCut;
  bool _DoElectron2DiscrByIsZllCut;
  bool _DoDiscrByMuon1MetMt;
  bool _DoDiscrByMuon2MetMt;
  bool _DoDiscrByElectron1MetMt;
  bool _DoDiscrByElectron2MetMt;
  bool _DoDiscrByTau1MetMt;
  bool _DoDiscrByTau2MetMt;
  double _Muon1MetMtMinCut;
  double _Muon1MetMtMaxCut;
  double _Muon2MetMtMinCut;
  double _Muon2MetMtMaxCut;
  double _Electron1MetMtMinCut;
  double _Electron1MetMtMaxCut;
  double _Electron2MetMtMinCut;
  double _Electron2MetMtMaxCut;
  double _Tau1MetMtMinCut;
  double _Tau1MetMtMaxCut;
  double _Tau2MetMtMinCut;
  double _Tau2MetMtMaxCut;
  string _DiTauDiscrByOSLSType;
  string _DiMuonDiscrByOSLSType;
  string _DiElectronDiscrByOSLSType;
  string _Muon1Tau1DiscrByOSLSType;
  string _Muon1Tau2DiscrByOSLSType;
  string _Muon2Tau1DiscrByOSLSType;
  string _Muon2Tau2DiscrByOSLSType;
  string _Electron1Tau1DiscrByOSLSType;
  string _Electron1Tau2DiscrByOSLSType;
  string _Electron2Tau1DiscrByOSLSType;
  string _Electron2Tau2DiscrByOSLSType;
  string _Electron1Muon1DiscrByOSLSType;
  string _Electron1Muon2DiscrByOSLSType;
  string _Electron2Muon1DiscrByOSLSType;
  string _Electron2Muon2DiscrByOSLSType;

  //-----SUSY Specific Topology Inputs
  bool _DoSUSYDiscrByMHT;
  double _MhtCut;
  bool _DoSUSYDiscrByR1;
  double _R1MinCut;
  double _R1MaxCut;
  bool _DoSUSYDiscrByR2;
  double _R2MinCut;
  double _R2MaxCut;
  bool _DoSUSYDiscrByAlpha;
  double _AlphaMinCut;
  double _AlphaMaxCut;
  bool _DoSUSYDiscrByDphi1;
  double _Dphi1MinCut;
  double _Dphi1MaxCut;
  bool _DoSUSYDiscrByDphi2;
  double _Dphi2MinCut;
  double _Dphi2MaxCut;

  //-----do matching to gen?
  bool _MatchTauToGen;
  bool _UseTauMotherId;
  bool _UseTauGrandMotherId;
  bool _MatchLeptonToGen;
  bool _UseLeptonMotherId;
  bool _UseLeptonGrandMotherId;
  int _TauMotherId;
  int _TauGrandMotherId;
  int _LeptonMotherId;
  int _LeptonGrandMotherId;
  double _TauToGenMatchingDeltaR;
  std::vector<reco::GenParticleRef> associatedGenParticles;
  reco::Candidate::LorentzVector MChadtau;
  const reco::Candidate * daughterCand;
  const reco::Candidate * motherCand;
  const reco::Candidate * grandMotherCand;

  //-----ntuple Inputs
  TTree *_HMTTree;
  std::string _NtupleTreeName;
  bool _DoProduceNtuple;

  //-----Fill Histograms?
  bool _FillRecoVertexHists;
  bool _FillGenTauHists;
  bool _FillRecoTauHists;
  bool _FillRecoMuonHists;
  bool _FillRecoElectronHists;
  bool _FillRecoJetHists;
  bool _FillTopologyHists;

  //-----histogram that keeps track of the number of analyzed events & the number of
  //-----events passing the user defined cuts
  std::map<unsigned int, TH1*> _hEvents;

  //-----vertex histograms
  std::map<unsigned int, TH1*> _hVertexZposition;
  std::map<unsigned int, TH1*> _hVertexNTracks;
  std::map<unsigned int, TH1*> _hNVertices;

  //-----generator level histograms
  std::map<unsigned int, TH1*> _hNGenTau;
  std::map<unsigned int, TH1*> _hGenTauEnergy;
  std::map<unsigned int, TH1*> _hGenTauPt;
  std::map<unsigned int, TH1*> _hGenTauEta;
  std::map<unsigned int, TH1*> _hGenTauPhi;
  std::map<unsigned int, TH1*> _hGenTauMotherEnergy;
  std::map<unsigned int, TH1*> _hGenTauMotherPt;
  std::map<unsigned int, TH1*> _hGenTauMotherEta;
  std::map<unsigned int, TH1*> _hGenTauMotherPhi;
  std::map<unsigned int, TH1*> _hGenTauGrandMotherEnergy;
  std::map<unsigned int, TH1*> _hGenTauGrandMotherPt;
  std::map<unsigned int, TH1*> _hGenTauGrandMotherEta;
  std::map<unsigned int, TH1*> _hGenTauGrandMotherPhi;

  //-----reconstruction level tau histograms
  std::map<unsigned int, TH1*> _hNTau1;
  std::map<unsigned int, TH1*> _hTauJet1Energy;
  std::map<unsigned int, TH1*> _hTauJet1Pt;
  std::map<unsigned int, TH1*> _hTauJet1Eta;
  std::map<unsigned int, TH1*> _hTauJet1Phi;
  std::map<unsigned int, TH1*> _hTauJet1NumSignalTracks;
  std::map<unsigned int, TH1*> _hTauJet1NumSignalGammas;
  std::map<unsigned int, TH1*> _hTauJet1SeedTrackPt;
  std::map<unsigned int, TH1*> _hTauJet1SeedTrackIpSignificance;
  std::map<unsigned int, TH1*> _hTauJet1SeedTrackNhits;
  std::map<unsigned int, TH1*> _hTauJet1SeedTrackChi2;
  std::map<unsigned int, TH1*> _hTauJet1Charge;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksMass;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksAndGammasMass;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksMass1prong;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksAndGammasMass1prong;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksAndPiZerosMass1prong;
  std::map<unsigned int, TH1*> _hTauJet1NumSignalPiZeros1prong;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksMass3prong;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksAndGammasMass3prong;
  std::map<unsigned int, TH1*> _hTauJet1Mass1Prong0Gamma;
  std::map<unsigned int, TH1*> _hTauJet1Mass1Prong1Gamma;
  std::map<unsigned int, TH1*> _hTauJet1Mass1Prong2orMoreGamma;
  std::map<unsigned int, TH1*> _hTauJet1Mass3Prong0Gamma;
  std::map<unsigned int, TH1*> _hTauJet1Mass3Prong1Gamma;
  std::map<unsigned int, TH1*> _hTauJet1Mass3Prong2orMoreGamma;
  std::map<unsigned int, TH1*> _hTauJet1SignalTracksChargeFraction;
  std::map<unsigned int, TH1*> _hTauJet1NumIsoTracks;
  std::map<unsigned int, TH1*> _hTauJet1NumIsoGammas;
  std::map<unsigned int, TH1*> _hTauJet1NumIsoCands;
  std::map<unsigned int, TH1*> _hTauJet1SumPtIsoTracks;
  std::map<unsigned int, TH1*> _hTauJet1SumPtIsoGammas;
  std::map<unsigned int, TH1*> _hTauJet1SumPtIso;
  std::map<unsigned int, TH1*> _hTauJet1NumberDensity;
  std::map<unsigned int, TH1*> _hTauJet1GenTauDeltaPhi;
  std::map<unsigned int, TH1*> _hTauJet1GenTauDeltaEta;
  std::map<unsigned int, TH1*> _hTauJet1GenTauDeltaPt;
  std::map<unsigned int, TH1*> _hTauJet1H3x3OverP;
  std::map<unsigned int, TH1*> _hNTau2;
  std::map<unsigned int, TH1*> _hTauJet2Energy;
  std::map<unsigned int, TH1*> _hTauJet2Pt;
  std::map<unsigned int, TH1*> _hTauJet2Eta;
  std::map<unsigned int, TH1*> _hTauJet2Phi;
  std::map<unsigned int, TH1*> _hTauJet2NumSignalTracks;
  std::map<unsigned int, TH1*> _hTauJet2NumSignalGammas;
  std::map<unsigned int, TH1*> _hTauJet2SeedTrackPt;
  std::map<unsigned int, TH1*> _hTauJet2SeedTrackIpSignificance;
  std::map<unsigned int, TH1*> _hTauJet2SeedTrackNhits;
  std::map<unsigned int, TH1*> _hTauJet2SeedTrackChi2;
  std::map<unsigned int, TH1*> _hTauJet2Charge;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksMass;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksAndGammasMass;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksMass1prong;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksAndGammasMass1prong;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksAndPiZerosMass1prong;
  std::map<unsigned int, TH1*> _hTauJet2NumSignalPiZeros1prong;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksMass3prong;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksAndGammasMass3prong;
  std::map<unsigned int, TH1*> _hTauJet2Mass1Prong0Gamma;
  std::map<unsigned int, TH1*> _hTauJet2Mass1Prong1Gamma;
  std::map<unsigned int, TH1*> _hTauJet2Mass1Prong2orMoreGamma;
  std::map<unsigned int, TH1*> _hTauJet2Mass3Prong0Gamma;
  std::map<unsigned int, TH1*> _hTauJet2Mass3Prong1Gamma;
  std::map<unsigned int, TH1*> _hTauJet2Mass3Prong2orMoreGamma;
  std::map<unsigned int, TH1*> _hTauJet2SignalTracksChargeFraction;
  std::map<unsigned int, TH1*> _hTauJet2NumIsoTracks;
  std::map<unsigned int, TH1*> _hTauJet2NumIsoGammas;
  std::map<unsigned int, TH1*> _hTauJet2NumIsoCands;
  std::map<unsigned int, TH1*> _hTauJet2SumPtIsoTracks;
  std::map<unsigned int, TH1*> _hTauJet2SumPtIsoGammas;
  std::map<unsigned int, TH1*> _hTauJet2SumPtIso;
  std::map<unsigned int, TH1*> _hTauJet2NumberDensity;
  std::map<unsigned int, TH1*> _hTauJet2GenTauDeltaPhi;
  std::map<unsigned int, TH1*> _hTauJet2GenTauDeltaEta;
  std::map<unsigned int, TH1*> _hTauJet2GenTauDeltaPt;
  std::map<unsigned int, TH1*> _hTauJet2H3x3OverP;

  //-----reconstruction level muon histograms
  std::map<unsigned int, TH1*> _hNMuon1;
  std::map<unsigned int, TH1*> _hMuon1Energy;
  std::map<unsigned int, TH1*> _hMuon1Pt;
  std::map<unsigned int, TH1*> _hMuon1Eta;
  std::map<unsigned int, TH1*> _hMuon1Phi;
  std::map<unsigned int, TH1*> _hMuon1TrackIso;
  std::map<unsigned int, TH1*> _hMuon1EcalIso;
  std::map<unsigned int, TH1*> _hMuon1Ip;
  std::map<unsigned int, TH1*> _hMuon1IpSignificance;
  std::map<unsigned int, TH1*> _hMuon1Iso;
  std::map<unsigned int, TH1*> _hMuon1GenMuonDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon1GenMuonDeltaEta;
  std::map<unsigned int, TH1*> _hMuon1GenMuonDeltaPt;
  std::map<unsigned int, TH1*> _hMuon1CaloCompatibility;
  std::map<unsigned int, TH1*> _hMuon1SegmentCompatibility;
  std::map<unsigned int, TH1*> _hMuon1AntiPion;
  std::map<unsigned int, TH2*> _hMuon1CaloCompatibilityVsSegmentCompatibility;
  std::map<unsigned int, TH1*> _hNMuon2;
  std::map<unsigned int, TH1*> _hMuon2Energy;
  std::map<unsigned int, TH1*> _hMuon2Pt;
  std::map<unsigned int, TH1*> _hMuon2Eta;
  std::map<unsigned int, TH1*> _hMuon2Phi;
  std::map<unsigned int, TH1*> _hMuon2TrackIso;
  std::map<unsigned int, TH1*> _hMuon2EcalIso;
  std::map<unsigned int, TH1*> _hMuon2Ip;
  std::map<unsigned int, TH1*> _hMuon2IpSignificance;
  std::map<unsigned int, TH1*> _hMuon2Iso;
  std::map<unsigned int, TH1*> _hMuon2GenMuonDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon2GenMuonDeltaEta;
  std::map<unsigned int, TH1*> _hMuon2GenMuonDeltaPt;
  std::map<unsigned int, TH1*> _hMuon2CaloCompatibility;
  std::map<unsigned int, TH1*> _hMuon2SegmentCompatibility;
  std::map<unsigned int, TH1*> _hMuon2AntiPion;
  std::map<unsigned int, TH2*> _hMuon2CaloCompatibilityVsSegmentCompatibility;

  //-----reconstruction level electron histograms  
  std::map<unsigned int, TH1*> _hNElectron1;
  std::map<unsigned int, TH1*> _hElectron1Energy;
  std::map<unsigned int, TH1*> _hElectron1Pt;
  std::map<unsigned int, TH1*> _hElectron1Eta;
  std::map<unsigned int, TH1*> _hElectron1Phi;
  std::map<unsigned int, TH1*> _hElectron1TrackIso;
  std::map<unsigned int, TH1*> _hElectron1EcalIso;
  std::map<unsigned int, TH1*> _hElectron1Ip;
  std::map<unsigned int, TH1*> _hElectron1EoverP;
  std::map<unsigned int, TH1*> _hElectron1Classification;
  std::map<unsigned int, TH1*> _hElectron1GenElectronDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron1GenElectronDeltaEta;
  std::map<unsigned int, TH1*> _hElectron1GenElectronDeltaPt;
  std::map<unsigned int, TH1*> _hElectron1EcalDriven;
  std::map<unsigned int, TH1*> _hElectron1TrackerDriven;
  std::map<unsigned int, TH1*> _hElectron1HoverEm;
  std::map<unsigned int, TH1*> _hElectron1EESigmaIEtaIEta;
  std::map<unsigned int, TH1*> _hElectron1EEDEta;
  std::map<unsigned int, TH1*> _hElectron1EEDPhi;
  std::map<unsigned int, TH1*> _hElectron1EBSigmaIEtaIEta;
  std::map<unsigned int, TH1*> _hElectron1EBDEta;
  std::map<unsigned int, TH1*> _hElectron1EBDPhi;
  std::map<unsigned int, TH1*> _hElectron1EB2by5Over5by5;
  std::map<unsigned int, TH1*> _hElectron1EB1by5Over5by5;
  std::map<unsigned int, TH1*> _hElectron1MissingHits;
  std::map<unsigned int, TH1*> _hNElectron2;
  std::map<unsigned int, TH1*> _hElectron2Energy;
  std::map<unsigned int, TH1*> _hElectron2Pt;
  std::map<unsigned int, TH1*> _hElectron2Eta;
  std::map<unsigned int, TH1*> _hElectron2Phi;
  std::map<unsigned int, TH1*> _hElectron2TrackIso;
  std::map<unsigned int, TH1*> _hElectron2EcalIso;
  std::map<unsigned int, TH1*> _hElectron2Ip;
  std::map<unsigned int, TH1*> _hElectron2EoverP;
  std::map<unsigned int, TH1*> _hElectron2Classification;
  std::map<unsigned int, TH1*> _hElectron2GenElectronDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron2GenElectronDeltaEta;
  std::map<unsigned int, TH1*> _hElectron2GenElectronDeltaPt;
  std::map<unsigned int, TH1*> _hElectron2EcalDriven;
  std::map<unsigned int, TH1*> _hElectron2TrackerDriven;
  std::map<unsigned int, TH1*> _hElectron2HoverEm;
  std::map<unsigned int, TH1*> _hElectron2EESigmaIEtaIEta;
  std::map<unsigned int, TH1*> _hElectron2EEDEta;
  std::map<unsigned int, TH1*> _hElectron2EEDPhi;
  std::map<unsigned int, TH1*> _hElectron2EBSigmaIEtaIEta;
  std::map<unsigned int, TH1*> _hElectron2EBDEta;
  std::map<unsigned int, TH1*> _hElectron2EBDPhi;
  std::map<unsigned int, TH1*> _hElectron2EB2by5Over5by5;
  std::map<unsigned int, TH1*> _hElectron2EB1by5Over5by5;
  std::map<unsigned int, TH1*> _hElectron2MissingHits;

  //-----reconstruction level jet histograms  
  std::map<unsigned int, TH1*> _hNJet;
  std::map<unsigned int, TH1*> _hNBJet;
  std::map<unsigned int, TH1*> _hJetEnergy;
  std::map<unsigned int, TH1*> _hJetPt;
  std::map<unsigned int, TH1*> _hJetEta;
  std::map<unsigned int, TH1*> _hJetPhi;
  std::map<unsigned int, TH1*> _hBJetDiscrByTrackCounting;
  std::map<unsigned int, TH1*> _hBJetDiscrBySimpleSecondaryV;
  std::map<unsigned int, TH1*> _hBJetDiscrByCombinedSecondaryV;
  std::map<unsigned int, TH1*> _hFirstLeadingJetPt;
  std::map<unsigned int, TH1*> _hSecondLeadingJetPt;
  std::map<unsigned int, TH1*> _hMHT;
  std::map<unsigned int, TH1*> _hHT;

  //-----reconstruction level topology histograms
  std::map<unsigned int, TH2*> _hMuon1PtVsTau1Pt;
  std::map<unsigned int, TH1*> _hMuon1Tau1DeltaR;
  std::map<unsigned int, TH1*> _hMuon1Tau1DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hMuon1Tau1DeltaPt;
  std::map<unsigned int, TH1*> _hMuon1Tau1OSLS;
  std::map<unsigned int, TH1*> _hMuon1Tau1CosDphi;
  std::map<unsigned int, TH2*> _hMuon1MetDeltaPhiVsMuon1Tau1CosDphi;
  std::map<unsigned int, TH2*> _hMuon1PtVsTau2Pt;
  std::map<unsigned int, TH1*> _hMuon1Tau2DeltaR;
  std::map<unsigned int, TH1*> _hMuon1Tau2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hMuon1Tau2DeltaPt;
  std::map<unsigned int, TH1*> _hMuon1Tau2OSLS;
  std::map<unsigned int, TH1*> _hMuon1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hMuon1MetDeltaPhiVsMuon1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hMuon2PtVsTau1Pt;
  std::map<unsigned int, TH1*> _hMuon2Tau1DeltaR;
  std::map<unsigned int, TH1*> _hMuon2Tau1DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hMuon2Tau1DeltaPt;
  std::map<unsigned int, TH1*> _hMuon2Tau1OSLS;
  std::map<unsigned int, TH1*> _hMuon2Tau1CosDphi;
  std::map<unsigned int, TH2*> _hMuon2MetDeltaPhiVsMuon2Tau1CosDphi;
  std::map<unsigned int, TH2*> _hMuon2PtVsTau2Pt;
  std::map<unsigned int, TH1*> _hMuon2Tau2DeltaR;
  std::map<unsigned int, TH1*> _hMuon2Tau2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hMuon2Tau2DeltaPt;
  std::map<unsigned int, TH1*> _hMuon2Tau2OSLS;
  std::map<unsigned int, TH1*> _hMuon2Tau2CosDphi;
  std::map<unsigned int, TH2*> _hMuon2MetDeltaPhiVsMuon2Tau2CosDphi;
  std::map<unsigned int, TH2*> _hElectron1PtVsTau1Pt;
  std::map<unsigned int, TH1*> _hElectron1Tau1DeltaR;
  std::map<unsigned int, TH1*> _hElectron1Tau1DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectron1Tau1DeltaPt;
  std::map<unsigned int, TH1*> _hElectron1Tau1OSLS;
  std::map<unsigned int, TH1*> _hElectron1Tau1CosDphi;
  std::map<unsigned int, TH2*> _hElectron1MetDeltaPhiVsElectron1Tau1CosDphi;
  std::map<unsigned int, TH2*> _hElectron1PtVsTau2Pt;
  std::map<unsigned int, TH1*> _hElectron1Tau2DeltaR;
  std::map<unsigned int, TH1*> _hElectron1Tau2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectron1Tau2DeltaPt;
  std::map<unsigned int, TH1*> _hElectron1Tau2OSLS;
  std::map<unsigned int, TH1*> _hElectron1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hElectron1MetDeltaPhiVsElectron1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hElectron2PtVsTau1Pt;
  std::map<unsigned int, TH1*> _hElectron2Tau1DeltaR;
  std::map<unsigned int, TH1*> _hElectron2Tau1DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectron2Tau1DeltaPt;
  std::map<unsigned int, TH1*> _hElectron2Tau1OSLS;
  std::map<unsigned int, TH1*> _hElectron2Tau1CosDphi;
  std::map<unsigned int, TH2*> _hElectron2MetDeltaPhiVsElectron2Tau1CosDphi;
  std::map<unsigned int, TH2*> _hElectron2PtVsTau2Pt;
  std::map<unsigned int, TH1*> _hElectron2Tau2DeltaR;
  std::map<unsigned int, TH1*> _hElectron2Tau2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectron2Tau2DeltaPt;
  std::map<unsigned int, TH1*> _hElectron2Tau2OSLS;
  std::map<unsigned int, TH1*> _hElectron2Tau2CosDphi;
  std::map<unsigned int, TH2*> _hElectron2MetDeltaPhiVsElectron2Tau2CosDphi;
  std::map<unsigned int, TH1*> _hMuon1Tau1_Muon1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon1Tau2_Muon1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon2Tau1_Muon2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon2Tau2_Muon2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon1Tau1_Tau1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon2Tau1_Tau1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon1Tau2_Tau2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon2Tau2_Tau2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron1Tau1_Tau1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron2Tau1_Tau1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron1Tau2_Tau2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron2Tau2_Tau2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron1Tau1_Electron1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron2Tau1_Electron2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron1Tau2_Electron1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hElectron2Tau2_Electron2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiMuon_Muon1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiMuon_Muon2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiTau_Tau1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiTau_Tau2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiElectron_Electron1MetDeltaPhi;
  std::map<unsigned int, TH1*> _hDiElectron_Electron2MetDeltaPhi;
  std::map<unsigned int, TH1*> _hMuon1Tau1_Muon1MetMt;
  std::map<unsigned int, TH1*> _hMuon1Tau2_Muon1MetMt;
  std::map<unsigned int, TH1*> _hMuon2Tau1_Muon2MetMt;
  std::map<unsigned int, TH1*> _hMuon2Tau2_Muon2MetMt;
  std::map<unsigned int, TH1*> _hMuon1Tau1_Tau1MetMt;
  std::map<unsigned int, TH1*> _hMuon2Tau1_Tau1MetMt;
  std::map<unsigned int, TH1*> _hMuon1Tau2_Tau2MetMt;
  std::map<unsigned int, TH1*> _hMuon2Tau2_Tau2MetMt;
  std::map<unsigned int, TH1*> _hElectron1Tau1_Tau1MetMt;
  std::map<unsigned int, TH1*> _hElectron2Tau1_Tau1MetMt;
  std::map<unsigned int, TH1*> _hElectron1Tau2_Tau2MetMt;
  std::map<unsigned int, TH1*> _hElectron2Tau2_Tau2MetMt;
  std::map<unsigned int, TH1*> _hElectron1Tau1_Electron1MetMt;
  std::map<unsigned int, TH1*> _hElectron2Tau1_Electron2MetMt;
  std::map<unsigned int, TH1*> _hElectron1Tau2_Electron1MetMt;
  std::map<unsigned int, TH1*> _hElectron2Tau2_Electron2MetMt;
  std::map<unsigned int, TH1*> _hDiMuon_Muon1MetMt;
  std::map<unsigned int, TH1*> _hDiMuon_Muon2MetMt;
  std::map<unsigned int, TH1*> _hDiTau_Tau1MetMt;
  std::map<unsigned int, TH1*> _hDiTau_Tau2MetMt;
  std::map<unsigned int, TH1*> _hDiElectron_Electron1MetMt;
  std::map<unsigned int, TH1*> _hDiElectron_Electron2MetMt;

/*
  std::map<unsigned int, TH2*> _hElectronPtVsMuonPt;
  std::map<unsigned int, TH1*> _hElectronMuonDeltaR;
  std::map<unsigned int, TH1*> _hElectronMuonDeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectronMuonDeltaPt;
  std::map<unsigned int, TH1*> _hElectronMuonOSLS;
  std::map<unsigned int, TH1*> _hElectronMuonCosDphi;
  std::map<unsigned int, TH2*> _hElectronMetDeltaPhiVsElectronMuonCosDphi;
*/

  std::map<unsigned int, TH2*> _hTau1PtVsTau2Pt;
  std::map<unsigned int, TH1*> _hTau1Tau2DeltaR;
  std::map<unsigned int, TH1*> _hTau1Tau2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hTau1Tau2DeltaPt;
  std::map<unsigned int, TH1*> _hTau1Tau2OSLS;
  std::map<unsigned int, TH1*> _hTau1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hTau1MetDeltaPhiVsTau1Tau2CosDphi;
  std::map<unsigned int, TH2*> _hMuon1PtVsMuon2Pt;
  std::map<unsigned int, TH1*> _hMuon1Muon2DeltaR;
  std::map<unsigned int, TH1*> _hMuon1Muon2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hMuon1Muon2DeltaPt;
  std::map<unsigned int, TH1*> _hMuon1Muon2OSLS;
  std::map<unsigned int, TH1*> _hMuon1Muon2CosDphi;
  std::map<unsigned int, TH2*> _hMuon1MetDeltaPhiVsMuon1Muon2CosDphi;
  std::map<unsigned int, TH2*> _hElectron1PtVsElectron2Pt;
  std::map<unsigned int, TH1*> _hElectron1Electron2DeltaR;
  std::map<unsigned int, TH1*> _hElectron1Electron2DeltaPtDivSumPt;
  std::map<unsigned int, TH1*> _hElectron1Electron2DeltaPt;
  std::map<unsigned int, TH1*> _hElectron1Electron2OSLS;
  std::map<unsigned int, TH1*> _hElectron1Electron2CosDphi;
  std::map<unsigned int, TH2*> _hElectron1MetDeltaPhiVsElectron1Electron2CosDphi;
  std::map<unsigned int, TH1*> _hDiTauNotReconstructableMass;
  std::map<unsigned int, TH1*> _hDiTauReconstructableMass;
  std::map<unsigned int, TH1*> _hDiTauNotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiTauReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiTauNotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiTauReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiTauPZeta;
  std::map<unsigned int, TH1*> _hDiTauPZetaVis;
  std::map<unsigned int, TH2*> _hDiTauZeta2D;
  std::map<unsigned int, TH1*> _hDiTauZeta1D;
  std::map<unsigned int, TH1*> _hDiMuonNotReconstructableMass;
  std::map<unsigned int, TH1*> _hDiMuonReconstructableMass;
  std::map<unsigned int, TH1*> _hDiMuonNotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiMuonReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiMuonNotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiMuonReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiMuonPZeta;
  std::map<unsigned int, TH1*> _hDiMuonPZetaVis;
  std::map<unsigned int, TH2*> _hDiMuonZeta2D;
  std::map<unsigned int, TH1*> _hDiMuonZeta1D;
  std::map<unsigned int, TH1*> _hDiElectronNotReconstructableMass;
  std::map<unsigned int, TH1*> _hDiElectronReconstructableMass;
  std::map<unsigned int, TH1*> _hDiElectronNotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiElectronReconstructableMassOS;
  std::map<unsigned int, TH1*> _hDiElectronNotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiElectronReconstructableMassLS;
  std::map<unsigned int, TH1*> _hDiElectronPZeta;
  std::map<unsigned int, TH1*> _hDiElectronPZetaVis;
  std::map<unsigned int, TH2*> _hDiElectronZeta2D;
  std::map<unsigned int, TH1*> _hDiElectronZeta1D;
  std::map<unsigned int, TH1*> _hMuon1Tau1NotReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon1Tau1ReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon1Tau1NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon1Tau1ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon1Tau1NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon1Tau1ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon1Tau1PZeta;
  std::map<unsigned int, TH1*> _hMuon1Tau1PZetaVis;
  std::map<unsigned int, TH2*> _hMuon1Tau1Zeta2D;
  std::map<unsigned int, TH1*> _hMuon1Tau1Zeta1D;
  std::map<unsigned int, TH1*> _hMuon1Tau2NotReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon1Tau2ReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon1Tau2NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon1Tau2ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon1Tau2NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon1Tau2ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon1Tau2PZeta;
  std::map<unsigned int, TH1*> _hMuon1Tau2PZetaVis;
  std::map<unsigned int, TH2*> _hMuon1Tau2Zeta2D;
  std::map<unsigned int, TH1*> _hMuon1Tau2Zeta1D;
  std::map<unsigned int, TH1*> _hMuon2Tau1NotReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon2Tau1ReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon2Tau1NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon2Tau1ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon2Tau1NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon2Tau1ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon2Tau1PZeta;
  std::map<unsigned int, TH1*> _hMuon2Tau1PZetaVis;
  std::map<unsigned int, TH2*> _hMuon2Tau1Zeta2D;
  std::map<unsigned int, TH1*> _hMuon2Tau1Zeta1D;
  std::map<unsigned int, TH1*> _hMuon2Tau2NotReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon2Tau2ReconstructableMass;
  std::map<unsigned int, TH1*> _hMuon2Tau2NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon2Tau2ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hMuon2Tau2NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon2Tau2ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hMuon2Tau2PZeta;
  std::map<unsigned int, TH1*> _hMuon2Tau2PZetaVis;
  std::map<unsigned int, TH2*> _hMuon2Tau2Zeta2D;
  std::map<unsigned int, TH1*> _hMuon2Tau2Zeta1D;
  std::map<unsigned int, TH1*> _hElectron1Tau1NotReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron1Tau1ReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron1Tau1NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron1Tau1ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron1Tau1NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron1Tau1ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron1Tau1PZeta;
  std::map<unsigned int, TH1*> _hElectron1Tau1PZetaVis;
  std::map<unsigned int, TH2*> _hElectron1Tau1Zeta2D;
  std::map<unsigned int, TH1*> _hElectron1Tau1Zeta1D;
  std::map<unsigned int, TH1*> _hElectron1Tau2NotReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron1Tau2ReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron1Tau2NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron1Tau2ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron1Tau2NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron1Tau2ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron1Tau2PZeta;
  std::map<unsigned int, TH1*> _hElectron1Tau2PZetaVis;
  std::map<unsigned int, TH2*> _hElectron1Tau2Zeta2D;
  std::map<unsigned int, TH1*> _hElectron1Tau2Zeta1D;
  std::map<unsigned int, TH1*> _hElectron2Tau1NotReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron2Tau1ReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron2Tau1NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron2Tau1ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron2Tau1NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron2Tau1ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron2Tau1PZeta;
  std::map<unsigned int, TH1*> _hElectron2Tau1PZetaVis;
  std::map<unsigned int, TH2*> _hElectron2Tau1Zeta2D;
  std::map<unsigned int, TH1*> _hElectron2Tau1Zeta1D;
  std::map<unsigned int, TH1*> _hElectron2Tau2NotReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron2Tau2ReconstructableMass;
  std::map<unsigned int, TH1*> _hElectron2Tau2NotReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron2Tau2ReconstructableMassOS;
  std::map<unsigned int, TH1*> _hElectron2Tau2NotReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron2Tau2ReconstructableMassLS;
  std::map<unsigned int, TH1*> _hElectron2Tau2PZeta;
  std::map<unsigned int, TH1*> _hElectron2Tau2PZetaVis;
  std::map<unsigned int, TH2*> _hElectron2Tau2Zeta2D;
  std::map<unsigned int, TH1*> _hElectron2Tau2Zeta1D;
  std::map<unsigned int, TH1*> _hMet;
  std::map<unsigned int, TH1*> _hMetResolution;
  std::map<unsigned int, TH1*> _hElectron1Tau1_Electron1IsZee;
  std::map<unsigned int, TH1*> _hElectron1Tau2_Electron1IsZee;
  std::map<unsigned int, TH1*> _hElectron2Tau1_Electron2IsZee;
  std::map<unsigned int, TH1*> _hElectron2Tau2_Electron2IsZee;
  std::map<unsigned int, TH1*> _hR1;
  std::map<unsigned int, TH1*> _hR2;
  std::map<unsigned int, TH1*> _hDphi1;
  std::map<unsigned int, TH1*> _hDphi2;
  std::map<unsigned int, TH1*> _hAlpha;
  std::map<unsigned int, TH2*> _hDphi1VsDphi2;

/* 
  std::map<unsigned int, TH1*> _hTauJetSumPtIso_JetOS;
  std::map<unsigned int, TH1*> _hTauJetSumPtIso_JetLS;
  std::map<unsigned int, TH1*> _hTauJetSumPtIso_SeedOS;
  std::map<unsigned int, TH1*> _hTauJetSumPtIso_SeedLS;
*/

  //-----Handle to tree collections
  Handle< reco::GenParticleCollection > _genParticles;
  Handle< pat::TauCollection >    _patTaus;
  Handle< pat::MuonCollection >    _patMuons;
  Handle< pat::ElectronCollection > _patElectrons;
  Handle< pat::JetCollection > _patJets;
  Handle< pat::METCollection > _patMETs;
//  Handle< reco::CompositeCandidateCollection > _patDiTaus;
  Handle< reco::VertexCollection > _primaryEventVertexCollection;
  edm::Handle< edm::TriggerResults > _triggerResults;
  edm::Handle< trigger::TriggerEvent > handleTriggerEvent;
  Handle< reco::PFCandidateCollection > _pflow;

  Handle< reco::PFTauCollection > _hpsTau;
  Handle< reco::GenMETCollection > genTrue;

  //-----Event Sequence inputTags
  int _RecoTriggersNmin;
  int _RecoVertexNmin;
  int _RecoVertexNmax;
  int _RecoMuon1Nmin;
  int _RecoMuon1Nmax;
  int _RecoMuon2Nmin;
  int _RecoMuon2Nmax;
  int _RecoElectron1Nmin;
  int _RecoElectron1Nmax;
  int _RecoElectron2Nmin;
  int _RecoElectron2Nmax;
  int _RecoTau1Nmin;
  int _RecoTau1Nmax;
  int _RecoTau2Nmin;
  int _RecoTau2Nmax;
  int _RecoJetNmin;
  int _RecoJetNmax;
  int _RecoFirstLeadingJetNmin;
  int _RecoSecondLeadingJetNmin;
  int _RecoBJetNmin;
  int _RecoBJetNmax;
  int _SusyCombinationsNmin;
  int _DiMuonCombinationsNmin;
  int _DiMuonCombinationsNmax;
  int _DiElectronCombinationsNmin;
  int _DiElectronCombinationsNmax;
  int _DiTauCombinationsNmin;
  int _DiTauCombinationsNmax;
  int _Muon1Tau1CombinationsNmin;
  int _Muon1Tau1CombinationsNmax;
  int _Muon1Tau2CombinationsNmin;
  int _Muon1Tau2CombinationsNmax;
  int _Muon2Tau1CombinationsNmin;
  int _Muon2Tau1CombinationsNmax;
  int _Muon2Tau2CombinationsNmin;
  int _Muon2Tau2CombinationsNmax;
  int _Electron1Tau1CombinationsNmin;
  int _Electron1Tau1CombinationsNmax;
  int _Electron1Tau2CombinationsNmin;
  int _Electron1Tau2CombinationsNmax;
  int _Electron2Tau1CombinationsNmin;
  int _Electron2Tau1CombinationsNmax;
  int _Electron2Tau2CombinationsNmin;
  int _Electron2Tau2CombinationsNmax;
  int _Electron1Muon1CombinationsNmin;
  int _Electron1Muon1CombinationsNmax;
  int _Electron1Muon2CombinationsNmin;
  int _Electron1Muon2CombinationsNmax;
  int _Electron2Muon1CombinationsNmin;
  int _Electron2Muon1CombinationsNmax;
  int _Electron2Muon2CombinationsNmin;
  int _Electron2Muon2CombinationsNmax;
  vector<string> _EventSelectionSequence;

  //-----boolean to determine if the sample is real data or simulation
  bool isData;

  //-----Event flags
  vector<bool> _EventFlag;

  //-----Event counters
  int _totalEvents;
  int _totalEventsPassingCuts;

  //-----Mapping of cut names and cut id
  std::map<string,int> _mapSelectionAlgoID;
  std::map<string,int> _mapSelectionCounter;
  std::map<string,int> _mapSelectionCounterCumul;

  //-----Inputs for systematic uncertainties
  bool _CalculatePdfSystematicUncertanties;
  bool _CalculateFSRSystematics;
  bool _CalculateISRGluonSystematics;
  bool _CalculateISRGammaSystematics;
  std::vector<edm::InputTag> pdfWeightTags_;
  InputTag FSRWeightTag_;
  InputTag ISRWeightTag_;
  std::vector<int> pdfStart_Denominator_;
  std::vector<double> weightedEvents_Denominator_;
  std::vector<int> pdfStart_Numerator_;
  std::vector<double> weightedEvents_Numerator_;
  double isrgluon_weight;
  double isrgamma_weight;
  double fsr_weight;
  double pu_weight;
  double trig_weight;
  double pdfcentral_weight;
  bool _SmearTheMuon;
  double _MuonPtScaleOffset;
  double _MuonPtSigmaOffset;
  double _MuonEtaScaleOffset;
  double _MuonEtaSigmaOffset;
  double _MuonPhiScaleOffset;
  double _MuonPhiSigmaOffset;
  bool _SmearTheElectron;
  double _ElectronPtScaleOffset;
  double _ElectronPtSigmaOffset;
  double _ElectronEtaScaleOffset;
  double _ElectronEtaSigmaOffset;
  double _ElectronPhiScaleOffset;
  double _ElectronPhiSigmaOffset;
  bool _SmearTheTau;
  double _TauPtScaleOffset;
  double _TauPtSigmaOffset;
  double _TauEtaScaleOffset;
  double _TauEtaSigmaOffset;
  double _TauPhiScaleOffset;
  double _TauPhiSigmaOffset;
  bool _SmearTheJet;
  bool _UseDataBaseForJEC;
  double _JetEnergyScaleOffset;
  double JES_UpOrDown;
  bool _SmearThePt;
  bool _SmearTheEta;
  bool _SmearThePhi;
  bool _CalculatePUSystematics;
  double _PUConstantWeightFactor;
  double _PUConstantWeightFactorRMS;
  double _PUSlopeWeightParameter;
  double _PUSlopeWeightParameterRMS;

  bool _ApplyMuonTriggerScaleFactors;
  bool _ApplyElectronTriggerScaleFactors;
  bool _ApplyTauTriggerScaleFactors;

  std::vector<reco::Candidate::LorentzVector> smearedMuonMomentumVector;
  std::vector<math::PtEtaPhiMLorentzVector> smearedMuonPtEtaPhiMVector;
  std::vector<reco::Candidate::LorentzVector> smearedElectronMomentumVector;
  std::vector<math::PtEtaPhiMLorentzVector> smearedElectronPtEtaPhiMVector;
  std::vector<reco::Candidate::LorentzVector> smearedTauMomentumVector;
  std::vector<math::PtEtaPhiMLorentzVector> smearedTauPtEtaPhiMVector;
  std::vector<reco::Candidate::LorentzVector> smearedJetMomentumVector;
  reco::Candidate::LorentzVector maxPtMuonVector;
  reco::Candidate::LorentzVector maxEtElectronVector;
  std::vector<math::PtEtaPhiMLorentzVector> smearedJetPtEtaPhiMVector;
  std::vector<double> bosonPtBinEdges_;
  std::vector<double> ptWeights_;
  std::vector<double> MuonTrigPtBinEdges_;
  std::vector<double> MuonTrigptWeights_;
  std::vector<double> MuonTrigEtaBinEdges_;
  std::vector<double> MuonTrigetaWeights_;
  std::vector<double> ElectronTrigPtBinEdges_;
  std::vector<double> ElectronTrigptWeights_;
  std::vector<double> ElectronTrigEtaBinEdges_;
  std::vector<double> ElectronTrigetaWeights_;
  std::vector<double> TauTrigPtBinEdges_;
  std::vector<double> TauTrigptWeights_;
  std::vector<double> TauTrigEtaBinEdges_;
  std::vector<double> TauTrigetaWeights_;

  double deltaForMEx;
  double deltaForMEy;
  reco::Candidate::LorentzVector theMETVector;
  
  //-----For Ntuple
  vector<double> pdfWeightVector;
  vector<float> *_jetPt;
  vector<float> *_jetEt;
  vector<float> *_jetEta;
  vector<float> *_jetPhi;
  vector<float> *_jetEmFraction;
  vector<float> *_bJetDiscrByTrackCounting;
  vector<float> *_bJetDiscrBySimpleSecondaryV;
  vector<float> *_bJetDiscrByCombinedSecondaryV;
  vector<float> *_tauTrkIsoPat;
  vector<float> *_muTrkIsoPat;
  vector<float> *_mEt;
  vector<float> *_zeta;
  vector<float> *_muTauMetMass;
  vector<float> *_muMetMass;
  vector<float> *_OSLS;

  const std::string Prefix,Suffix;
  const boost::regex scanFormat;
  const std::vector<std::string> scanPars;

};
